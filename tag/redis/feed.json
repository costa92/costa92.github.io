{
    "version": "https://jsonfeed.org/version/1",
    "title": "山海行码",
    "subtitle": "山海行码",
    "icon": "https://costalong.com/images/favicon.ico",
    "description": "",
    "home_page_url": "https://costalong.com",
    "items": [
        {
            "id": "https://costalong.com/2023/01/30/go-redis-jiao-cheng/",
            "url": "https://costalong.com/2023/01/30/go-redis-jiao-cheng/",
            "title": "go-redis 教程",
            "date_published": "2023-01-30T04:25:44.000Z",
            "content_html": "<h2 id=\"安装go-redis包\"><a href=\"#安装go-redis包\" class=\"headerlink\" title=\"安装go-redis包\"></a>安装go-redis包</h2><pre class=\" language-bash\"><code class=\"language-bash\">go get github.com/redis/go-redis/v9\n</code></pre>\n<h2 id=\"连接-redis-服务\"><a href=\"#连接-redis-服务\" class=\"headerlink\" title=\"连接 redis 服务\"></a>连接 redis 服务</h2><ol>\n<li>使用 options 方式</li>\n</ol>\n<pre class=\" language-go\"><code class=\"language-go\"><span class=\"token keyword\">package</span> main\n\n<span class=\"token keyword\">import</span> <span class=\"token string\">\"github.com/redis/go-redis/v9\"</span>\n\n<span class=\"token keyword\">func</span> <span class=\"token function\">main</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span>\n    rdb <span class=\"token operator\">:=</span> redis<span class=\"token punctuation\">.</span><span class=\"token function\">NewClient</span><span class=\"token punctuation\">(</span><span class=\"token operator\">&amp;</span>redis<span class=\"token punctuation\">.</span>Options<span class=\"token punctuation\">{</span>\n        Addr<span class=\"token punctuation\">:</span>\t  <span class=\"token string\">\"localhost:6379\"</span><span class=\"token punctuation\">,</span>\n        Password<span class=\"token punctuation\">:</span> <span class=\"token string\">\"\"</span><span class=\"token punctuation\">,</span> <span class=\"token comment\" spellcheck=\"true\">// no password set</span>\n        DB<span class=\"token punctuation\">:</span>\t\t  <span class=\"token number\">0</span><span class=\"token punctuation\">,</span>  <span class=\"token comment\" spellcheck=\"true\">// use default DB</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n    res<span class=\"token punctuation\">,</span> err <span class=\"token operator\">:=</span> rdb<span class=\"token punctuation\">.</span><span class=\"token function\">Ping</span><span class=\"token punctuation\">(</span>ctx<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">Result</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">if</span> err <span class=\"token operator\">!=</span> <span class=\"token boolean\">nil</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token function\">panic</span><span class=\"token punctuation\">(</span>err<span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">}</span>\n    fmt<span class=\"token punctuation\">.</span><span class=\"token function\">Println</span><span class=\"token punctuation\">(</span>res<span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span>\n</code></pre>\n<ol start=\"2\">\n<li>使用 dns 字符串方式</li>\n</ol>\n<pre class=\" language-go\"><code class=\"language-go\"><span class=\"token keyword\">package</span> main\n\n<span class=\"token keyword\">import</span> <span class=\"token string\">\"github.com/redis/go-redis/v9\"</span>\n\n<span class=\"token keyword\">func</span> <span class=\"token function\">main</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span>\n    <span class=\"token comment\" spellcheck=\"true\">// 注意 redis 是没有用户的，所以user 设置为空 </span>\n    opt<span class=\"token punctuation\">,</span> err <span class=\"token operator\">:=</span> redis<span class=\"token punctuation\">.</span><span class=\"token function\">ParseURL</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"redis://&lt;user>:&lt;pass>@localhost:6379/&lt;db>\"</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">if</span> err <span class=\"token operator\">!=</span> <span class=\"token boolean\">nil</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token function\">panic</span><span class=\"token punctuation\">(</span>err<span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">}</span>\n    rdb <span class=\"token operator\">:=</span> redis<span class=\"token punctuation\">.</span><span class=\"token function\">NewClient</span><span class=\"token punctuation\">(</span>opt<span class=\"token punctuation\">)</span>\n    res<span class=\"token punctuation\">,</span> err <span class=\"token operator\">:=</span> rdb<span class=\"token punctuation\">.</span><span class=\"token function\">Ping</span><span class=\"token punctuation\">(</span>ctx<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">Result</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">if</span> err <span class=\"token operator\">!=</span> <span class=\"token boolean\">nil</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token function\">panic</span><span class=\"token punctuation\">(</span>err<span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">}</span>\n    fmt<span class=\"token punctuation\">.</span><span class=\"token function\">Println</span><span class=\"token punctuation\">(</span>res<span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span>\n</code></pre>\n<ol start=\"3\">\n<li>连接 redis 服务设置连接名字</li>\n</ol>\n<pre class=\" language-go\"><code class=\"language-go\"><span class=\"token keyword\">package</span> main\n\n<span class=\"token keyword\">import</span> <span class=\"token string\">\"github.com/redis/go-redis/v9\"</span>\n\n<span class=\"token keyword\">func</span> <span class=\"token function\">main</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span>\n    <span class=\"token comment\" spellcheck=\"true\">// 注意 redis 是没有用户的，所以user 设置为空 </span>\n    opt<span class=\"token punctuation\">,</span> err <span class=\"token operator\">:=</span> redis<span class=\"token punctuation\">.</span><span class=\"token function\">ParseURL</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"redis://&lt;user>:&lt;pass>@localhost:6379/&lt;db>\"</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">if</span> err <span class=\"token operator\">!=</span> <span class=\"token boolean\">nil</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token function\">panic</span><span class=\"token punctuation\">(</span>err<span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">}</span>\n    rdb <span class=\"token operator\">:=</span> redis<span class=\"token punctuation\">.</span><span class=\"token function\">NewClient</span><span class=\"token punctuation\">(</span>opt<span class=\"token punctuation\">)</span>\n    res<span class=\"token punctuation\">,</span> err <span class=\"token operator\">:=</span> rdb<span class=\"token punctuation\">.</span><span class=\"token function\">Ping</span><span class=\"token punctuation\">(</span>ctx<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">Result</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">if</span> err <span class=\"token operator\">!=</span> <span class=\"token boolean\">nil</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token function\">panic</span><span class=\"token punctuation\">(</span>err<span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">}</span>\n    fmt<span class=\"token punctuation\">.</span><span class=\"token function\">Println</span><span class=\"token punctuation\">(</span>res<span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span>\n</code></pre>\n<h2 id=\"redis-数据类型\"><a href=\"#redis-数据类型\" class=\"headerlink\" title=\"redis 数据类型\"></a>redis 数据类型</h2><p>redis 的数据类型有五种，分别为: 字符串(string)、列表(list)、集合(set)、哈希(hash)、有序集合(zset)</p>\n<h3 id=\"操作字符串-string\"><a href=\"#操作字符串-string\" class=\"headerlink\" title=\"操作字符串 (string)\"></a>操作字符串 (string)</h3><ol>\n<li>获取字符串内容执行命令</li>\n</ol>\n<p>redis 命令</p>\n<pre class=\" language-redis\"><code class=\"language-redis\">get mykey\n</code></pre>\n<p>直接返回结果</p>\n<pre class=\" language-go\"><code class=\"language-go\">key <span class=\"token operator\">:=</span> <span class=\"token string\">\"mykey\"</span>\nctx <span class=\"token operator\">:=</span> context<span class=\"token punctuation\">.</span><span class=\"token function\">Background</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\nval<span class=\"token punctuation\">,</span> err <span class=\"token operator\">:=</span> rdb<span class=\"token punctuation\">.</span><span class=\"token function\">Get</span><span class=\"token punctuation\">(</span>ctx<span class=\"token punctuation\">,</span> key<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">Result</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">if</span> err <span class=\"token operator\">!=</span> <span class=\"token boolean\">nil</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token function\">panic</span><span class=\"token punctuation\">(</span>err<span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span>\nfmt<span class=\"token punctuation\">.</span><span class=\"token function\">Println</span><span class=\"token punctuation\">(</span>val<span class=\"token punctuation\">)</span>\n</code></pre>\n<p>保存命令并稍后分别访问值与错误</p>\n<pre class=\" language-go\"><code class=\"language-go\">key <span class=\"token operator\">:=</span> <span class=\"token string\">\"mykey\"</span>\nctx <span class=\"token operator\">:=</span> context<span class=\"token punctuation\">.</span><span class=\"token function\">Background</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\nget <span class=\"token operator\">:=</span> rdb<span class=\"token punctuation\">.</span><span class=\"token function\">Get</span><span class=\"token punctuation\">(</span>ctx<span class=\"token punctuation\">,</span> key<span class=\"token punctuation\">)</span>\n\nfmt<span class=\"token punctuation\">.</span><span class=\"token function\">Println</span><span class=\"token punctuation\">(</span>get<span class=\"token punctuation\">.</span><span class=\"token function\">Val</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n</code></pre>\n<p>执行go-redis包不支持的命令</p>\n<pre class=\" language-go\"><code class=\"language-go\">key <span class=\"token operator\">:=</span> <span class=\"token string\">\"mykey\"</span>\nctx <span class=\"token operator\">:=</span> context<span class=\"token punctuation\">.</span><span class=\"token function\">Background</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\nval<span class=\"token punctuation\">,</span> err <span class=\"token operator\">:=</span> rdb<span class=\"token punctuation\">.</span><span class=\"token function\">Do</span><span class=\"token punctuation\">(</span>ctx<span class=\"token punctuation\">,</span> <span class=\"token string\">\"get\"</span><span class=\"token punctuation\">,</span> key<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">Result</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">if</span> err <span class=\"token operator\">!=</span> <span class=\"token boolean\">nil</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">if</span> err <span class=\"token operator\">==</span> redis<span class=\"token punctuation\">.</span>Nil <span class=\"token punctuation\">{</span>\n        fmt<span class=\"token punctuation\">.</span><span class=\"token function\">Println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"key dose not exists\"</span><span class=\"token punctuation\">)</span>\n        <span class=\"token keyword\">return</span>\n    <span class=\"token punctuation\">}</span>\n    <span class=\"token function\">panic</span><span class=\"token punctuation\">(</span>err<span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span>\nfmt<span class=\"token punctuation\">.</span><span class=\"token function\">Println</span><span class=\"token punctuation\">(</span>val<span class=\"token punctuation\">)</span>\n</code></pre>\n<pre class=\" language-go\"><code class=\"language-go\">key <span class=\"token operator\">:=</span> <span class=\"token string\">\"mykey\"</span>\nctx <span class=\"token operator\">:=</span> context<span class=\"token punctuation\">.</span><span class=\"token function\">Background</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\nval<span class=\"token punctuation\">,</span> err <span class=\"token operator\">:=</span> rdb<span class=\"token punctuation\">.</span><span class=\"token function\">Do</span><span class=\"token punctuation\">(</span>ctx<span class=\"token punctuation\">,</span> <span class=\"token string\">\"get\"</span><span class=\"token punctuation\">,</span> key<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">Text</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\nfmt<span class=\"token punctuation\">.</span><span class=\"token function\">Println</span><span class=\"token punctuation\">(</span>val<span class=\"token punctuation\">,</span> err<span class=\"token punctuation\">)</span>\n</code></pre>\n<p>帮助函数完整列表:</p>\n<pre class=\" language-go\"><code class=\"language-go\">s<span class=\"token punctuation\">,</span> err <span class=\"token operator\">:=</span> cmd<span class=\"token punctuation\">.</span><span class=\"token function\">Text</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\nflag<span class=\"token punctuation\">,</span> err <span class=\"token operator\">:=</span> cmd<span class=\"token punctuation\">.</span><span class=\"token function\">Bool</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n\nnum<span class=\"token punctuation\">,</span> err <span class=\"token operator\">:=</span> cmd<span class=\"token punctuation\">.</span><span class=\"token function\">Int</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\nnum<span class=\"token punctuation\">,</span> err <span class=\"token operator\">:=</span> cmd<span class=\"token punctuation\">.</span><span class=\"token function\">Int64</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\nnum<span class=\"token punctuation\">,</span> err <span class=\"token operator\">:=</span> cmd<span class=\"token punctuation\">.</span><span class=\"token function\">Uint64</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\nnum<span class=\"token punctuation\">,</span> err <span class=\"token operator\">:=</span> cmd<span class=\"token punctuation\">.</span><span class=\"token function\">Float32</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\nnum<span class=\"token punctuation\">,</span> err <span class=\"token operator\">:=</span> cmd<span class=\"token punctuation\">.</span><span class=\"token function\">Float64</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n\nss<span class=\"token punctuation\">,</span> err <span class=\"token operator\">:=</span> cmd<span class=\"token punctuation\">.</span><span class=\"token function\">StringSlice</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\nns<span class=\"token punctuation\">,</span> err <span class=\"token operator\">:=</span> cmd<span class=\"token punctuation\">.</span><span class=\"token function\">Int64Slice</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\nns<span class=\"token punctuation\">,</span> err <span class=\"token operator\">:=</span> cmd<span class=\"token punctuation\">.</span><span class=\"token function\">Uint64Slice</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\nfs<span class=\"token punctuation\">,</span> err <span class=\"token operator\">:=</span> cmd<span class=\"token punctuation\">.</span><span class=\"token function\">Float32Slice</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\nfs<span class=\"token punctuation\">,</span> err <span class=\"token operator\">:=</span> cmd<span class=\"token punctuation\">.</span><span class=\"token function\">Float64Slice</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\nbs<span class=\"token punctuation\">,</span> err <span class=\"token operator\">:=</span> cmd<span class=\"token punctuation\">.</span><span class=\"token function\">BoolSlice</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n</code></pre>\n<ol start=\"2\">\n<li>设置字符串数据</li>\n</ol>\n<p>redis 命令</p>\n<pre class=\" language-redis\"><code class=\"language-redis\">set mykey \"ddd\" EX 10 \n</code></pre>\n<p>go-redis </p>\n<pre class=\" language-go\"><code class=\"language-go\">key <span class=\"token operator\">:=</span> <span class=\"token string\">\"mykey\"</span>\nctx <span class=\"token operator\">:=</span> context<span class=\"token punctuation\">.</span><span class=\"token function\">Background</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\ncmd <span class=\"token operator\">:=</span> rdb<span class=\"token punctuation\">.</span><span class=\"token function\">Set</span><span class=\"token punctuation\">(</span>ctx<span class=\"token punctuation\">,</span> key<span class=\"token punctuation\">,</span> <span class=\"token string\">\"ddd\"</span><span class=\"token punctuation\">,</span> <span class=\"token number\">10</span><span class=\"token punctuation\">)</span>   \nfmt<span class=\"token punctuation\">.</span><span class=\"token function\">Println</span><span class=\"token punctuation\">(</span>cmd<span class=\"token punctuation\">.</span><span class=\"token function\">Result</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n</code></pre>\n<p>设置key到期的时间</p>\n<pre class=\" language-go\"><code class=\"language-go\">expireAt <span class=\"token operator\">:=</span> time<span class=\"token punctuation\">.</span><span class=\"token function\">Now</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">AddDate</span><span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">,</span> <span class=\"token number\">1</span><span class=\"token punctuation\">,</span> <span class=\"token number\">1</span><span class=\"token punctuation\">)</span>\nargs <span class=\"token operator\">:=</span> redis<span class=\"token punctuation\">.</span>SetArgs<span class=\"token punctuation\">{</span>\n    ExpireAt<span class=\"token punctuation\">:</span> expireAt\n<span class=\"token punctuation\">}</span>\nfmt<span class=\"token punctuation\">.</span><span class=\"token function\">Println</span><span class=\"token punctuation\">(</span>args<span class=\"token punctuation\">)</span>\nctx <span class=\"token operator\">:=</span> context<span class=\"token punctuation\">.</span><span class=\"token function\">Background</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\nerr <span class=\"token operator\">:=</span> rdb<span class=\"token punctuation\">.</span><span class=\"token function\">SetArgs</span><span class=\"token punctuation\">(</span>ctx<span class=\"token punctuation\">,</span> <span class=\"token string\">\"key\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"hello\"</span><span class=\"token punctuation\">,</span> args<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">Err</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">if</span> err <span class=\"token operator\">!=</span> <span class=\"token boolean\">nil</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token function\">panic</span><span class=\"token punctuation\">(</span>err<span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span>\n</code></pre>\n<link rel=\"stylesheet\" href=\"/css/spoiler.css\" type=\"text/css\"><script src=\"/js/spoiler.js\" type=\"text/javascript\" async></script>",
            "tags": [
                "go",
                "redis"
            ]
        }
    ]
}